"use strict";(()=>{var e={};e.id=7570,e.ids=[7570],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},7873:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>_,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>v});var s={};t.r(s),t.d(s,{POST:()=>POST}),t(95655);var a=t(83323),o=t(54647),i=t(63866),n=t(59859),u=t(60954),p=t(66886);async function POST(e){let r;let t=process.env.NEXT_CLERK_WEBHOOK_SECRET;if(!t)throw Error("Please add WEBHOOK_SECRET from Clerk Dashboard to .env or .env.local");let s=(0,n.headers)(),a=s.get("svix-id"),o=s.get("svix-timestamp"),d=s.get("svix-signature");if(!a||!o||!d)return new Response("Error occured -- no svix headers",{status:400});let l=await e.json(),c=JSON.stringify(l),x=new i.Webhook(t);try{r=x.verify(c,{"svix-id":a,"svix-timestamp":o,"svix-signature":d})}catch(e){return console.error("Error verifying webhook:",e),new Response("Error occured",{status:400})}let m=r.type;if("user.created"===m){let{id:e,email_addresses:t,image_url:s,username:a,first_name:o,last_name:i}=r.data,n=await (0,u.createUser)({clerkId:e,name:`${o}${i?` ${i}`:""}`,username:a,email:t[0].email_address,picture:s});return p.Z.json({message:"OK",user:n})}if("user.updated"===m){let{id:e,email_addresses:t,image_url:s,username:a,first_name:o,last_name:i}=r.data,n=await (0,u.updateUser)({clerkId:e,updateData:{name:`${o}${i?` ${i}`:""}`,username:a,email:t[0].email_address,picture:s},path:`/profile/${e}`});return p.Z.json({message:"OK",user:n})}if("user.deleted"===m){let{id:e}=r.data,t=await (0,u.deleteUser)({clerkId:e});return p.Z.json({message:"OK",user:t})}return p.Z.json({message:"OK"})}let d=a.AppRouteRouteModule,l=new d({definition:{kind:o.x.APP_ROUTE,page:"/api/webhook/route",pathname:"/api/webhook",filename:"route",bundlePath:"app/api/webhook/route"},resolvedPagePath:"C:\\Users\\af_K_ar\\stack_overflow_nextjs14\\app\\api\\webhook\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:x,serverHooks:m,headerHooks:g,staticGenerationBailout:v}=l,_="/api/webhook/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[9922,9859,1209,3640,9727,3866,9614,954],()=>__webpack_exec__(7873));module.exports=t})();