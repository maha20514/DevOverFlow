"use strict";exports.id=954,exports.ids=[954],exports.modules={60954:(e,t,a)=>{a.r(t),a.d(t,{createUser:()=>createUser,deleteUser:()=>deleteUser,getAllUsers:()=>getAllUsers,getSavedQuestions:()=>getSavedQuestions,getUserAnswers:()=>getUserAnswers,getUserById:()=>getUserById,getUserInfo:()=>getUserInfo,getUserQuestions:()=>getUserQuestions,toggleSaveQuestion:()=>toggleSaveQuestion,updateUser:()=>updateUser});var s=a(10459),o=a(18886),r=a(78291),n=a(50561),i=a(7427),c=a(48275),d=a(95639),l=a(35082);async function getUserById(e){try{(0,r.v)();let{userId:t}=e,a=await o.Z.findOne({clerkId:t});return a}catch(e){throw console.log(e),e}}async function createUser(e){try{(0,r.v)();let t=await o.Z.create(e);return t}catch(e){throw console.log(e),e}}async function updateUser(e){try{(0,r.v)();let{clerkId:t,updateData:a,path:s}=e;await o.Z.findOneAndUpdate({clerkId:t},a,{new:!0}),(0,n.revalidatePath)(s)}catch(e){throw console.log(e),e}}async function deleteUser(e){try{(0,r.v)();let{clerkId:t}=e,a=await o.Z.findOneAndDelete({clerkId:t});if(!a)throw Error("User not found");await i.Z.deleteMany({author:a._id});let s=await o.Z.findByIdAndDelete(a._id);return s}catch(e){throw console.log(e),e}}async function getAllUsers(e){try{(0,r.v)();let{searchQuery:t,filter:a,page:s=1,pageSize:n=10}=e,i=(s-1)*n,c={};if(t){let e=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");c.$or=[{name:{$regex:RegExp(e,"i")}},{username:{$regex:RegExp(e,"i")}}]}let d={};switch(a){case"new_users":d={joinedAt:-1};break;case"old_users":d={joinedAt:1};break;case"top_contributors":d={reputation:-1}}let l=await o.Z.find(c).sort(d).skip(i).limit(n),u=await o.Z.countDocuments(c),g=u>i+l.length;return{users:l,isNext:g}}catch(e){throw console.log(e),e}}async function toggleSaveQuestion(e){try{(0,r.v)();let{userId:t,questionId:a,path:s}=e,i=await o.Z.findById(t);if(!i)throw Error("User not found");let c=i.saved.includes(a);c?await o.Z.findByIdAndUpdate(t,{$pull:{saved:a}},{new:!0}):await o.Z.findByIdAndUpdate(t,{$addToSet:{saved:a}},{new:!0}),(0,n.revalidatePath)(s)}catch(e){throw console.log(e),e}}async function getSavedQuestions(e){try{(0,r.v)();let{clerkId:t,searchQuery:a,filter:s,page:n=1,pageSize:i=20}=e,d=a?{title:{$regex:RegExp(a,"i")}}:{},l={};switch(s){case"most_recent":l={createdAt:-1};break;case"oldest":l={createdAt:1};break;case"most_voted":l={upvotes:-1};break;case"most_viewed":l={views:-1};break;case"most_answered":l={answers:-1}}let u=await o.Z.findOne({clerkId:t}).populate({path:"saved",match:d,options:{sort:l,skip:(n-1)*i,limit:i+1},populate:[{path:"tags",model:c.Z,select:"_id name"},{path:"author",model:o.Z,select:"_id clerkId name picture"}]}),g=u.saved.length>i;if(!u)throw Error("User not found");let U=u.saved;return{questions:U,isNext:g}}catch(e){throw console.log(e),e}}async function getUserInfo(e){try{(0,r.v)();let{userId:t}=e,a=await o.Z.findOne({clerkId:t});if(!a)throw Error("User not found");let s=await i.Z.countDocuments({author:a._id}),n=await d.Z.countDocuments({author:a._id}),[c]=await i.Z.aggregate([{$match:{author:a._id}},{$project:{_id:0,upvotes:{$size:"$upvotes"}}},{$group:{_id:null,totalUpvotes:{$sum:"$upvotes"}}}]),[u]=await d.Z.aggregate([{$match:{author:a._id}},{$project:{_id:0,upvotes:{$size:"$upvotes"}}},{$group:{_id:null,totalUpvotes:{$sum:"$upvotes"}}}]),[g]=await d.Z.aggregate([{$match:{author:a._id}},{$group:{_id:null,totalViews:{$sum:"$views"}}}]),U=[{type:"QUESTION_COUNT",count:s},{type:"ANSWER_COUNT",count:n},{type:"QUESTION_UPVOTES",count:c?.totalUpvotes||0},{type:"ANSWER_UPVOTES",count:u?.totalUpvotes||0},{type:"TOTAL_VIEWS",count:g?.totalViews||0}],p=(0,l.gI)({criteria:U});return{user:a,totalQuestions:s,totalAnswers:n,badgeCounts:p,reputation:a.reputation}}catch(e){throw console.log(e),e}}async function getUserQuestions(e){try{(0,r.v)();let{userId:t,page:a=1,pageSize:s=10}=e,o=(a-1)*s,n=await i.Z.countDocuments({author:t}),c=await i.Z.find({author:t}).sort({createdAt:-1,views:-1,upvotes:-1}).skip(o).limit(s).populate("tags","_id name").populate("author","_id clerkId name picture"),d=n>o+c.length;return{totalQuestions:n,questions:c,isNextQuestions:d}}catch(e){throw console.log(e),e}}async function getUserAnswers(e){try{(0,r.v)();let{userId:t,page:a=1,pageSize:s=10}=e,o=(a-1)*s,n=await d.Z.countDocuments({author:t}),i=await d.Z.find({author:t}).sort({upvotes:-1}).skip(o).limit(s).populate("question","_id title").populate("author","_id clerkId name picture"),c=n>o+i.length;return{totalAnswers:n,answers:i,isNextAnswer:c}}catch(e){throw console.log(e),e}}(0,a(51419).h)([getUserById,createUser,updateUser,deleteUser,getAllUsers,toggleSaveQuestion,getSavedQuestions,getUserInfo,getUserQuestions,getUserAnswers]),(0,s.U)("fc4877523a45028429d9a70350ff51de17b607a9",null,getUserById),(0,s.U)("7d20741c78a0b68592df13e4ffe92a94afa22362",null,createUser),(0,s.U)("11bc936fed380b52618f262897b07b2059703b1e",null,updateUser),(0,s.U)("62037266a36f7331f901cadf4479632dccd62993",null,deleteUser),(0,s.U)("5eac4975dfc1d67df097009d83eaa9b62fde705d",null,getAllUsers),(0,s.U)("64b2e76038ba15cd0ea85bcd5fa20e8ab9ddd862",null,toggleSaveQuestion),(0,s.U)("3eff637a2f553dfb93da6bf176d7af974fc22146",null,getSavedQuestions),(0,s.U)("1c04a387b8c5cab08c3f4be50f63d49799b74556",null,getUserInfo),(0,s.U)("25593527bec0b3a35f1445a2cb3d5f0b2625b887",null,getUserQuestions),(0,s.U)("3434ed278f0c14a85d4d88ccce6c26d1a0ee95a7",null,getUserAnswers)}};